<ion-header>
  <ion-toolbar color="light">
    <ion-buttons slot="start">
   <!--  <ion-button (click)="goToDashboard()" fill="solid" color="primary" style="display:inline-flex;align-items:center;"> -->
      <ion-back-button defaultHref="/dashboard"></ion-back-button>
        <ion-icon name="arrow-back-outline" slot="start" style="font-size: 22px;"></ion-icon>
        <span style="margin-left:4px;">Dashboard</span>
    </ion-buttons>
    <ion-title class="title">Statistiche</ion-title>
  </ion-toolbar>
</ion-header>


<ion-content class="ion-padding stats-page">
<!-- Metric selector -->
<div class="metric-selector">
<div class="metric-scroll" style="overflow-x: auto; white-space: nowrap;">
  <div class="metrics-row" style="display: inline-flex;">
    <button
      *ngFor="let m of metrics"
      (click)="selectMetric(m)"
      [class.active]="selectedMetric === m"
      class="metric-pill"
      style="margin-right: 8px;"
    >
      {{ m }}
    </button>
  </div>
</div>
</div>


<!-- Period selector -->
<div class="period-selector">
  <ion-segment [value]="selectedPeriod" (ionChange)="selectPeriod($event.detail.value)">
    <ion-segment-button *ngFor="let p of periods" [value]="p">
      {{ p }}
    </ion-segment-button>
  </ion-segment>
</div>


<!-- Chart card -->
<div class="chart-card">
<div *ngIf="lineChartData && lineChartData.labels && lineChartData.labels.length > 0; else noChartData">
  <canvas
    baseChart
    [data]="lineChartData"
    [type]="'bar'"
    [options]="lineChartOptions">
  </canvas>
</div>
<ng-template #noChartData>
  <div class="empty-chart-message" style="text-align:center; color:#888; padding:24px;">
    Nessun dato disponibile per il grafico.<br>
    Se hai appena registrato dati, aggiorna la pagina.<br>
    <span style="font-size:13px;">
      (Debug: labels={{ lineChartData && lineChartData.labels ? lineChartData.labels.length : 0 }},
      datasets={{ lineChartData && lineChartData.datasets ? lineChartData.datasets.length : 0 }})
    </span>
  </div>
</ng-template>
</div>


<!-- Quick stats -->
<div class="quick-stats">
  <div class="stat-card">
    <div class="stat-label">{{selectedMetric}} medio</div>
    <div class="stat-value">{{ formatValue(quickStats.average) }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Trend</div>
    <div class="stat-value">{{ quickStats.trend !== 0 ? (formatValue(quickStats.trend) + '%') : '-' }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Periodo</div>
    <div class="stat-value">{{ quickStats.period }}</div>
  </div>
</div>
</ion-content>